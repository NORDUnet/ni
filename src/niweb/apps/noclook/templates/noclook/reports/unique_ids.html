{% extends "noclook/reports/base_report.html" %}
{% load crispy_forms_tags %}
{% block title %}{{ block.super }} {{ organisation }} reserved ID list{% endblock %}
{% block js %}
    {{ block.super }}
    <script type="text/javascript">
    $(document).ready(
       function(){
            $("#reserved").tablesorter(
            {
                //sortList: [[0,0]],
                headers:
                {
                   4: { sorter: "isoDate" }
                },
                widthFixed: true,
                widgets: ['zebra']
            });
            $(".table-to-csv").click(function() {
                var elem = $(this);
                elem.css('cursor','wait');
                // Set table id here
                var table = buildJSONTable($("#reserved"));
                postJSONTable('csv', elem, table.header, table.data)
            });
           $(".table-to-xls").click(function() {
                var elem = $(this);
               elem.css('cursor','wait');
                // Set table id here
                var table = buildJSONTable($("#reserved"));
               postJSONTable('xls', elem, table.header, table.data)
            });
        }
    );
    </script>
{% endblock %}
{% block content %}
{{ block.super }}
  <h1>{{ organisation }} unique IDs</h1>
  <div class="well">
    <form action="" method="post" class="form-horizontal">
      {% csrf_token %}
      {{ search_form | crispy }}
      <div class="controls">
        <input type="submit" class="btn btn-primary" value="Search" />
        <a href="." class="btn">Show all</a>
      </div>
    </form>
  </div>
    {% if not id_list %}
      <h2>No ids found</h2>
    {% else %}
        <p class="pull-right"><span class="table-to-csv btn btn-link"><i class="icon-download"></i> CSV</span> <span class="table-to-xls btn btn-link"><i class="icon-download"></i> Excel</span></p>
        <table id="reserved" class="table table-striped table-condensed" cellspacing="1">
            <thead>
                <tr>
                    <th>ID</th><th>Reserved</th><th>Reserve message</th><th>Reserver</th><th>Created</th>
                </tr>
            </thead>
            <tbody>
                {% for id in id_list %}
                    <tr>
                        <td>{{ id.unique_id }}</td>
                        <td>{{ id.reserved }}</td>
                        <td>{{ id.reserve_message|default_if_none:"" }}</td>
                        <td>{{ id.reserver|default_if_none:"" }}</td>
                        <td>{{ id.created }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div>
            <ul class="pager">
            {% if id_list.has_previous %}
                <li><a href="?page={{ id_list.previous_page_number }}">previous</a></li>
            {% endif %}
                <li>
                    Page {{ id_list.number }} of {{ id_list.paginator.num_pages }}.
                </li>
            {% if id_list.has_next %}
                <li>
                    <a href="?page={{ id_list.next_page_number }}">next</a>
                </li>
            {% endif %}
            </ul>
        </div>
    {% endif %}
{% endblock %}
