<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #map_canvas { height: 100% }
</style>
{% load niweb_tags %}
<script language="javascript" type="text/javascript" src="{% niweb_media_url %}js/jquery/jquery-1.6.2.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false&key=AIzaSyCxqtNjP8a1vDnviEnktTPijjBYvqzeWTo" type="text/javascript"></script>
<script type="text/javascript">
    function initialize() {
        var latlng = new google.maps.LatLng(63, 10.4);
        var myOptions = {
            zoom: 5,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        load_content(map)
    }
    function load_content(map) {
        var map = map
        $.getJSON('/gmaps/{{ slug }}.json', function(json) {
            for (var i = 0;i < json.length; i += 1) {
                var lat = json[i].lat;
                var lng = json[i].lng;
                var label = json[i].name;
                addMarker(lat,lng,label);
            };

            function addMarker(lat,lng,label){
                var latlng = new google.maps.LatLng(lat,lng);
                var marker = new google.maps.Marker({
                    position: latlng,
                    title: label,
                    map: map
                });
            };
        });
    }
</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>
