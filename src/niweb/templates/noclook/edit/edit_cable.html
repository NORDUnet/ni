{% extends "noclook/edit/base_edit.html" %}

{% block js %}
{{ block.super }}
{% load niweb_tags %}
<script language="javascript" type="text/javascript" src="{% niweb_media_url %}js/jquery/jquery.jCombo.js"></script>
<script type="text/javascript">
$(document).ready(
    function(){
        // Modal delete object confirm
        $("#dialog-object-confirm").dialog({
          modal: true,
                bgiframe: true,
                width: 500,
                height: 200,
          autoOpen: false
          });

        $("#object-confirm").click(function(e) {
            e.preventDefault();
            var theHREF = $(this).attr("href");


            $("#dialog-object-confirm").dialog('option', 'buttons', {
                    "Confirm" : function() {
                        window.location.href = theHREF;
                        },
                    "Cancel" : function() {
                        $(this).dialog("close");
                        }
                    });

            $("#dialog-object-confirm").dialog("open");
        });
        // End A //
        // Populate first level combo box
        $.getJSON('/formdata/site/', function(data) {
            $('#level0A').append($('<option>').val("0").text("-- Please Select --"));
            $.each(data, function(key, tuple) {
                $('#level0A').append($('<option>').val(tuple[0]).text(tuple[1]));
            });
        });
        // Hook lower level combo boxes up to their parent
        $("#level1A").jCombo("/formdata/{id}/children", {
                        parent: "#level0A",
                        end_value_field: "#id_relationship_end_a",
                    });
        $("#level2A").jCombo("/formdata/{id}/children", {
                        parent: "#level1A",
                        end_value_field: "#id_relationship_end_a",
                    });
        // Hook lower level combo boxes up to their parent
        $("#level3A").jCombo("/formdata/{id}/children", {
                        parent: "#level2A",
                        end_value_field: "#id_relationship_end_a",
                    });
        $("#level4A").jCombo("/formdata/{id}/children", {
                        parent: "#level3A",
                        end_value_field: "#id_relationship_end_a",
                    });
        // End B //
        // Populate first level combo box
        $.getJSON('/formdata/site/', function(data) {
            $('#level0B').append($('<option>').val("0").text("-- Please Select --"));
            $.each(data, function(key, tuple) {
                $('#level0B').append($('<option>').val(tuple[0]).text(tuple[1]));
            });
        });
        // Hook lower level combo boxes up to their parent
        $("#level1B").jCombo("/formdata/{id}/children", {
                        parent: "#level0B",
                        end_value_field: "#id_relationship_end_b",
                    });
        $("#level2B").jCombo("/formdata/{id}/children", {
                        parent: "#level1B",
                        end_value_field: "#id_relationship_end_b",
                    });
        // Hook lower level combo boxes up to their parent
        $("#level3B").jCombo("/formdata/{id}/children", {
                        parent: "#level2B",
                        end_value_field: "#id_relationship_end_b",
                    });
        $("#level4B").jCombo("/formdata/{id}/children", {
                        parent: "#level3B",
                        end_value_field: "#id_relationship_end_b",
                    });
        // Modal delete connection confirm
        $("#dialog-connection-confirm").dialog({
          modal: true,
                bgiframe: true,
                width: 500,
                height: 200,
          autoOpen: false
          });

        $("#connection-confirm").click(function(e) {
            e.preventDefault();
            var theHREF = $(this).attr("href");


            $("#dialog-connection-confirm").dialog('option', 'buttons', {
                    "Confirm" : function() {
                        window.location.href = theHREF;
                        },
                    "Cancel" : function() {
                        $(this).dialog("close");
                        }
                    });

            $("#dialog-connection-confirm").dialog("open");

        });
        // Hide sections
        $('#connection-section').find("> a").click(function() {
            $(this).toggleClass("section-closed").toggleClass("section-open").next().toggle();
            return false;
        }).end().find("> div").hide();
        $('#telenor-section').find("> a").click(function() {
            $(this).toggleClass("source-closed").toggleClass("source-open").next().toggle();
            return false;
        }).end().find("> div").hide();
        $('#globalc-section').find("> a").click(function() {
            $(this).toggleClass("source-closed").toggleClass("source-open").next().toggle();
            return false;
        }).end().find("> div").hide();
    }
);
</script>
{% endblock %}

{% block content %}
{{ block.super }}
    <div id="dialog-connection-confirm" title="Remove connection?">
        <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>The connection will be permanently deleted and cannot be recovered. Are you sure?</p>
    </div>
    <div class="well">
        <h3>Name</h3>
        {{ form.name }}
        <h3>Type (optional)</h3>
        {{ form.cable_type }}
    </div>
    <div id="connection-section">
        <h3>Connections (optional)</h3>
        <a href="#" class="section-open">View</a>
        <div>
            <div class="well">
                <h4>Add Connection</h4>
                <div class="row">
                    <div class="span3">
                        {{ form.relationship_end_a }}
                        <select class="stacked" name="level0A" id="level0A"></select>
                        <select class="stacked" name="level1A" id="level1A"></select>
                        <select class="stacked" name="level2A" id="level2A"></select>
                        <select class="stacked" name="level3A" id="level3A"></select>
                        <select class="stacked" name="level4A" id="level4A"></select>
                        <span class="help-block">Choose end A</span>
                    </div>
                    <div class="span3">
                        {{ form.relationship_end_b }}
                        <select class="stacked" name="level0B" id="level0B"></select>
                        <select class="stacked" name="level1B" id="level1B"></select>
                        <select class="stacked" name="level2B" id="level2B"></select>
                        <select class="stacked" name="level3B" id="level3B"></select>
                        <select class="stacked" name="level4B" id="level4B"></select>
                        <span class="help-block">Choose end B</span>
                    </div>
                </div>
            </div>
            {% if connections %}
            <div class="well">
                {% load noclook_tags %}
                <h4>Remove Connection</h4>
                {% for con in connections %}
                    <div class="row">
                        <div class="span5">
                            Connected to <a href="{% noclook_node_to_url con.port %}">{{ con.end.name }} {{ con.port.name }}</a>
                        </div>
                        <div class="span1">
                            <a href="relationship/{{ con.rel.id }}/delete" class="label label-important" id="connection-confirm">Delete</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    <div id="telenor-section">
        <h3>Telenor Information (optional)</h3><a href="#" class="section-closed">View</a>
        <div class="well">
            <label>TN1 Number</label>
            {{ form.telenor_tn1_number }}
            <span class="help-inline">{{ form.telenor_tn1_number.help_text }}</span>
            <label>Trunk ID</label>
            {{ form.telenor_trunk_id }}
            <span class="help-inline">{{ form.telenor_trunk_id.help_text }}</span>
        </div>
    </div>
    <div id="globalc-section">
        <h3>Global Crossing Information (optional)</h3><a href="#" class="section-closed">View</a>
        <div class="well">
            <table>
                <tr>
                    <td width="50px"><label>Circuit ID</label></td>
                    <td>{{ form.global_crossing_circuit_id }}<span class="help-inline">{{ form.global_crossing_circuit_id.help_text }}</span></td>
                </tr>
            </table>
        </div>
    </div>
{% endblock %}

