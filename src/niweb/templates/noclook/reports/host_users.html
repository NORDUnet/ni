{% extends "noclook/reports/base_report.html" %}

{% block title %}{{ block.super }} | Host reports | Host users{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript">
        $(document).ready(
            function(){
                $("#hosts").tablesorter(
                    {
                        sortList: [[0,0], [1,0]],
                        headers:
                        {
                            3 : { sorter: "isoDate" }
                        },
                        widthFixed: true,
                        widgets: ['zebra']
                    });

                $(".table-to-csv").click(function() {
                    var elem = $(this);
                    elem.css('cursor','wait');
                    // Set table id here
                    var table = buildJSONTable($("#hosts"));
                    postJSONTable('csv', elem, table.header, table.data)

                });
                $(".table-to-xls").click(function() {
                    var elem = $(this);
                    elem.css('cursor','wait');
                    // Set table id here
                    var table = buildJSONTable($("#hosts"));
                    postJSONTable('xls', elem, table.header, table.data)
                });
            }
        );
    </script>
{% endblock %}

{% block content %}
    {{ block.super }}
    <h1>Host users</h1>
    <hr>
    <ul class="nav nav-pills">
        {% if host_user_name == "All" %}
            <li class="active"><a href="/reports/hosts/host-users/All/">All</a></li>
        {% else %}
            <li class=""><a href="/reports/hosts/host-users/All/">All</a></li>
        {% endif %}
        {% for key in host_users %}
            {% if key == host_user_name %}
                <li class="active"><a href="/reports/hosts/host-users/{{ key }}/">{{ key }}</a></li>
            {% else %}
                <li class=""><a href="/reports/hosts/host-users/{{ key }}/">{{ key }}</a></li>
            {% endif %}
        {% endfor %}
        {% if host_user_name == "Missing" %}
            <li class="active"><a href="/reports/hosts/host-users/Missing/">Hosts missing user</a></li>
        {% else %}
            <li class=""><a href="/reports/hosts/host-users/Missing/">Hosts missing user</a></li>
        {% endif %}
    </ul>
    {% if hosts %}
        <h3>Hosts for {{ host_user_name }}: {{ hosts|length }}</h3>
        <div class="pull-right">
            <span class="badge badge-warning">+14 days</span>
            <span class="badge badge-important">+30 days</span>
            <span class="table-to-csv btn btn-link"><i class="icon-download"></i> CSV</span>
            <span class="table-to-xls btn btn-link"><i class="icon-download"></i> Excel</span>
        </div>
        <table id="hosts" class="tablesorter" cellspacing="1">
            <thead>
                <tr>
                    <th>Host user</th><th>Host</th><th>Host type</th><th>IP address(es)</th><th>Contract number</th><th>Description</th><th>Responsible</th><th>Backup</th><th>Syslog</th><th>In operation</th><th>Location</th><th>Last seen</th><th>Uptime</th>
                </tr>
            </thead>
            <tbody>
                {% load noclook_tags %}
                {% for item in hosts %}
                    {% if item.age == "old" %}
                        <tr class="report-old">
                    {% elif item.age == "very_old" %}
                        <tr class="report-very-old">
                    {% else %}
                        <tr>
                    {% endif %}
                    <td>{{ item.host_user.name }}</td>
                    <td><a href="{% noclook_node_to_url item.host %}">{{ item.host.name }}</a></td>
                    <td>{{ item.host_type|capfirst }} host</td>
                    <td>
                        {% for address in item.host.addresses %}
                            {{ address }}{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    </td>
                    <td>{{ item.host.contract_number|default:"" }}</td>
                    <td>{{ item.host.description|default:"" }}</td>
                    <td>
                        {% for responsible in item.host.responsible_persons %}
                            {{ responsible }}{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    </td>
                    <td>{{ item.host.backup|yesno:"Yes,No,Not set" }}</td>
                    <td>{{ item.host.syslog|yesno:"Yes,No,Not set" }}</td>
                    <td>{{ item.host.in_operation|yesno:"Yes,No,Not set" }}</td>
                    <td>
                        {% for loc in item.location %}
                            <a href="{% noclook_node_to_url loc.parent %}"> {{ loc.parent.name }}</a> <a href="{% noclook_node_to_url loc.loc %}"> {{ loc.loc.name }}</a>
                        {% endfor %}
                    </td>
                    <td>{% noclook_last_seen_to_dt item.host.noclook_last_seen as last_seen%}{{ last_seen|date }}</td>
                    <td></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}
